<!doctype html>
<html lang="ja">
<head>
<script src="./test1.js" defer></script>
<base href="/Dialogue-Shadowing/">
<link rel="stylesheet" href="test1.css">


<meta charset="utf-8">
<title>Dialogue Shadowing</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#f4f6fb;
  --card:#ffffff;
  --line:#e3e6ef;
  --accent:#4f6bed;
  --accent-soft:#e8ecff;
  --text:#222;
  --sub:#666;
}
*{box-sizing:border-box}
body{
  font-family: system-ui, -apple-system, "Noto Sans JP", sans-serif;
  background:linear-gradient(180deg,#eef1fb,#f9faff);
  margin:16px;
  color:var(--text);
}
.wrap{max-width:900px;margin:auto;}
h2{margin:0 0 12px;font-weight:800;letter-spacing:.02em;}

.card{
  background:var(--card);
  border-radius:18px;
  border:1px solid var(--line);
  padding:14px;
  margin-bottom:14px;
  box-shadow:0 6px 18px rgba(0,0,0,.04);
}

label{display:block;font-size:12px;color:var(--sub);margin-bottom:6px;}
.small{font-size:12px;color:var(--sub)}
.row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;align-items:center;}

textarea{
  width:100%;
  height:160px;
  padding:12px;
  border-radius:14px;
  border:1px solid var(--line);
  background:#fafbff;
  font-size:14px;
  resize:vertical;
}
button,select{
  padding:8px 12px;
  border-radius:12px;
  border:1px solid var(--line);
  background:white;
  cursor:pointer;
  transition:.15s;
}
button:hover,select:hover{background:var(--accent-soft);}

.dialogue{margin-top:18px;padding-bottom:240px;}
.turn{display:flex;margin:12px 0;}
.left{justify-content:flex-start;}
.right{justify-content:flex-end;}

.bubble{
  max-width:75%;
  padding:12px 14px;
  border-radius:18px;
  border:1px solid var(--line);
  background:white;
  box-shadow:0 4px 12px rgba(0,0,0,.04);
  transition:.2s;
}
.meta{font-size:12px;color:var(--sub);margin-bottom:6px;}
.en{font-size:16px;line-height:1.5;}
.ja{font-size:14px;color:#333;margin-top:6px;line-height:1.5;}
.focus{
  outline:3px solid var(--accent);
  outline-offset:2px;
  box-shadow:0 0 0 6px rgba(79,107,237,.15);
}

.noteTa{
  margin-top:8px;
  height:60px;
  border-radius:12px;
  border:1px solid var(--line);
  padding:8px;
  font-size:13px;
  background:#fff;
}

/* floating panel */
.floatNav{
  position:fixed;
  left:16px;
  bottom:16px;
  z-index:9999;
  display:flex;
  flex-direction:column;
  gap:10px;
  padding:12px;
  background:rgba(255,255,255,0.95);
  border-radius:18px;
  border:1px solid var(--line);
  box-shadow:0 10px 28px rgba(0,0,0,.18);
  width:min(340px, calc(100vw - 32px));
  backdrop-filter: blur(8px);
}
.floatRow{display:flex;gap:10px;align-items:center;justify-content:space-between;}
.floatRow button{
  flex:1;
  font-weight:700;
  background:var(--accent);
  color:white;
  border:none;
}
.floatRow button:hover{background:#3e5be0;}
.floatLabel{font-size:12px;color:var(--sub);min-width:22px;text-align:center;}
.floatNav select{flex:1;text-align:center;}
.pill{
  display:inline-flex;gap:8px;align-items:center;
  padding:6px 10px;border-radius:999px;border:1px solid var(--line);
  background:#fff;
}
.mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;}
hr{border:none;border-top:1px solid var(--line);margin:12px 0;}

/* 折りたたみ（追加） */
.floatNav.collapsed{
  width: 84px;
  padding: 10px;
}
.floatNav.collapsed .floatRow:not(:first-child){
  display: none;
}

/* toggleボタンだけ見た目を別にする（追加） */
#toggleFloat{
  flex: 0 0 auto;
  width: 52px;
  height: 40px;
  border-radius: 14px;
  border: 1px solid var(--line);
  background: white;
  color: var(--text);
  font-weight: 800;
}
.floatNav.collapsed #toggleFloat{
  background: var(--accent);
  color: white;
  border: none;
}

</style>
</head>

<body>
<div class="wrap">
  <h2>Dialogue Shadowing</h2>

  <div class="card">
    <label>台本（TSV形式 speaker[TAB]英[TAB]日）</label>
    <textarea id="input">A	Hey, are you free this weekend?	今週末空いてる？
B	Yeah, what’s up?	うん、どうしたの？
A	I’m thinking of going hiking.	ハイキングに行こうと思ってて。
B	Sounds good. Where to?	いいね。どこに行く？</textarea>

    <div class="row">
      <button id="renderBtn">表示</button>
      <button id="clearBtn">会話クリア</button>
      <span class="pill small">台本ID：<span id="scriptId" class="mono">-</span></span>
      <button id="resetNotesBtn" title="この台本のメモだけ消します">この台本のメモを消す</button>
    </div>
    <div class="small">メモは台本ごとに自動保存されます（再読み込みしても消えません）。</div>
  </div>

  <div class="card">
    <div class="row">
      <select id="myRole"></select>
      <label class="pill"><input type="checkbox" id="hideMyLines"> 自分のセリフを隠す</label>
      <label class="pill"><input type="checkbox" id="showNotes" checked> メモ表示</label>

      <select id="modeA">
        <option value="both">A: 英日</option>
        <option value="en">A: 英</option>
        <option value="ja">A: 日</option>
        <option value="hide">A: 非</option>
      </select>

      <select id="modeB">
        <option value="both">B: 英日</option>
        <option value="en">B: 英</option>
        <option value="ja">B: 日</option>
        <option value="hide">B: 非</option>
      </select>
    </div>

    <div class="small">右下（左下）パネルでも「前/次」「A/B表示切替」ができます。</div>
  </div>

  <div id="dialogue" class="dialogue"></div>

  <!-- ✅ 追加：メモ一覧（コピー用） -->
  <div class="card">
    <label>メモ一覧（コピー用）</label>
    <div class="row">
      <button id="refreshSummaryBtn">一覧を更新</button>
      <button id="copySummaryBtn">コピー</button>
      <span id="copyMsg" class="small"></span>
    </div>
    <textarea id="summary" style="height:220px" placeholder="ここにメモが一覧表示されます（「一覧を更新」）。" readonly></textarea>
    <div class="small">形式：Turn / Speaker / EN / Note（メモが空の行は出しません）</div>
  </div>
</div>

<!-- floating panel -->
<div class="floatNav" id="floatNav">
  <div class="floatRow">
    <button id="toggleFloat" type="button">▾</button>
    <div class="small" style="flex:1; text-align:right; padding-right:4px;">Panel</div>
  </div>

  <div class="floatRow">
    <button id="floatPrev" type="button">← 前</button>
    <button id="floatNext" type="button">次 →</button>
  </div>

  <div class="floatRow">
    <span class="floatLabel">A</span>
    <select id="floatModeA">
      <option value="both">英日</option>
      <option value="en">英</option>
      <option value="ja">日</option>
      <option value="hide">非</option>
    </select>
    <span class="floatLabel">B</span>
    <select id="floatModeB">
      <option value="both">英日</option>
      <option value="en">英</option>
      <option value="ja">日</option>
      <option value="hide">非</option>
    </select>
  </div>
</div>
</body>

</html>